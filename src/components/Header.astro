---
import HeaderLink from "./HeaderLink.astro";
import "../assets/styles/header.css";

const { default: moon } = await import(`/src/assets/icons/moon.svg?raw`);
const { default: cross } = await import(`/src/assets/icons/xmark.svg?raw`);
const { default: menu } = await import(`/src/assets/icons/bars.svg?raw`);
const { default: sun } = await import(`/src/assets/icons/sun.svg?raw`);

const today = new Date();

const theme = Astro.cookies.get("theme")?.value ?? "light";
---

<header class="header center">
  <nav class="nav center">
    <ul class="nav__list center">
      <HeaderLink href="/">Home</HeaderLink>
      <HeaderLink href="/about">About</HeaderLink>
      <HeaderLink href="/projects">Projects</HeaderLink>
      <HeaderLink href="/blog">Blogs</HeaderLink>
      <HeaderLink href="/contact">Contact</HeaderLink>
    </ul>

    <button id="theme-toggle" type="button" aria-label="toggle theme" class="btn btn--icon">
      <Fragment set:html={moon} />
      <Fragment set:html={sun} />
    </button>

    <button type="button" aria-label="toggle navigation" class="btn btn--icon nav__hamburger">
      <Fragment set:html={menu} />
      <Fragment set:html={cross} />
    </button>
  </nav>
</header>

<script>
  const body = document.body;
  const btnTheme = document.querySelector("#theme-toggle");
  const btnHamburger = document.querySelector(".nav__hamburger");
  const navUl = document.querySelector(".nav__list");
  const moon = document.querySelector('svg[data-id="moon"');
  const sun = document.querySelector('svg[data-id="sun"');

  type Themes = "light" | "dark";

  function isDark() {
    return body.classList.contains("dark");
  }

  function changeTheme(theme: Themes) {
    body.className = "";
    body.classList.add(theme);
  }

  function setTheme(theme: Themes) {
    changeTheme(theme);
    const d = new Date();
    d.setTime(d.getTime() + 365 * 86400000);
    document.cookie = `theme=${theme};expires=${d.toUTCString()}`;
  }

  btnTheme?.addEventListener("click", () => {
    if (isDark()) {
      setTheme("light");
    } else {
      setTheme("dark");
    }
  });

  window.addEventListener("DOMContentLoaded", () => {
    const cookies = document.cookie;
    const match = cookies.match("theme=([^;]+)");
    let theme = "light";
    if (match) {
      theme = match[1];
    }
    changeTheme(theme as Themes);
  });

  // Navigation
  function closeNav() {
    navUl?.classList.remove("display-nav-list");
    btnHamburger?.children[0].classList.remove("d-none");
    btnHamburger?.children[1].classList.add("d-none");
    body.classList.remove("nav-open");
  }

  function openNav() {
    btnHamburger?.children[0].classList.add("d-none");
    btnHamburger?.children[1].classList.remove("d-none");
    navUl?.classList.add("display-nav-list");
    body.classList.add("nav-open");
  }

  btnHamburger?.addEventListener("click", () => {
    if (btnHamburger?.children[1].classList.contains("d-none")) {
      openNav();
    } else {
      closeNav();
    }
  });
</script>

<style>
  :global([data-id="moon"]),
  :global([data-id="sun"]) {
    fill: var(--clr-primary);
  }

  :global(.header svg) {
    width: 16px;
  }

  :global(.light [data-id="moon"]) {
    display: block;
  }
  :global(.light [data-id="sun"]) {
    display: none;
  }
  :global(.dark [data-id="sun"]) {
    display: block;
  }
  :global(.dark [data-id="moon"]) {
    display: none;
  }
</style>
